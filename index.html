<!doctype html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
    body { background-color: #0d1117; color: #c9d1d9; -webkit-tap-highlight-color: transparent; overscroll-behavior: none; }
    body.tg-webapp { margin-top: 20px; }
    .container { max-width: 1280px; margin: 0 auto; padding: 20px; }
    header { display: flex; align-items: center; justify-content: space-between; padding: 16px 0; border: none; margin: 0; }
    .logo { display: flex; align-items: center; gap: 8px; font-size: 24px; font-weight: 600; }
    .options-section { margin-bottom: 20px; padding: 15px; background: #0d1117; border-radius: 6px; border: 1px solid #30363d; }
    .options-title { font-weight: 600; margin-bottom: 10px; }
    .option-buttons { display: flex; gap: 10px; flex-wrap: wrap; }
    .option-btn { padding: 8px 16px; border-radius: 6px; background: rgba(35,134,54); color: white; border: 1px solid rgba(69,152,84); cursor: pointer; transition: background-color 0.2s; }
    .option-btn:active { opacity: 0.8; }
    .modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: #0d1117; z-index: 1000; opacity: 0; pointer-events: none; transition: opacity 0.3s; display: flex; flex-direction: column; }
    .modal.active { opacity: 1; pointer-events: all; }
    .modal-header { padding: 12px 16px; background: #161b22; border-bottom: 1px solid #30363d; display: flex; justify-content: space-between; align-items: center; }
    .modal-title { font-weight: 600; }
    .modal-close { background: none; border: none; font-size: 20px; cursor: pointer; color: #8b949e; padding: 4px; }
    .preview-wrapper { position: relative; flex: 1; background: #0d1117; }
    .preview-content { width: 100%; height: 100%; border: none; background: #0d1117; display: none; }
    .loader { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); border: 4px solid transparent; border-top: 4px solid transparent; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4/dist/js-yaml.min.js"></script>
</head>
<body>
  <div class="container">
    <header><div class="logo"><span></span></div></header>
    <div class="options-section">
      <div class="options-title">Choose application</div><br>
      <div class="option-buttons" id="buttons"></div>
    </div>
  </div>

  <div class="modal" id="previewModal">
    <div class="modal-header" id="modalHeader">
      <div class="modal-title" id="modalTitle"></div>
      <button class="modal-close" id="closePreviewModal">&times;</button>
    </div>
    <div class="preview-wrapper">
      <div class="loader" id="loader"></div>
      <iframe class="preview-content" id="preview-frame" allowtransparency="true"></iframe>
    </div>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
  document.addEventListener('DOMContentLoaded', async function() {
  const isTelegramWebApp = window.Telegram?.WebApp?.initData !== undefined;
  if (isTelegramWebApp) {
    document.body.classList.add('tg-webapp');
    document.getElementById('modalHeader').style.display = 'none';
  }

  const previewModal = document.getElementById('previewModal');
  const closePreviewModal = document.getElementById('closePreviewModal');
  const previewFrame = document.getElementById('preview-frame');
  const modalTitle = document.getElementById('modalTitle');
  const loader = document.getElementById('loader');
  const modalHeader = document.getElementById('modalHeader');
  const buttonsContainer = document.getElementById('buttons');

  function openModal(title, src) {
    modalTitle.textContent = title;
    loader.style.display = "block";
    previewFrame.style.display = "none";
    previewFrame.src = src;
    previewModal.classList.add('active');
    document.body.style.overflow = 'hidden';
    if (isTelegramWebApp) {
      const tg = Telegram.WebApp;
      tg.BackButton.show();
      tg.BackButton.onClick(closeModal);
    }
  }

  function closeModal() {
    previewModal.classList.remove('active');
    previewFrame.src = "";
    document.body.style.overflow = 'auto';
    if (isTelegramWebApp) {
      Telegram.WebApp.BackButton.hide();
    }
  }

  closePreviewModal.addEventListener('click', closeModal);
  previewFrame.addEventListener('load', () => {
    loader.style.display = "none";
    previewFrame.style.display = "block";
  });
  document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

  if (isTelegramWebApp) {
    const tg = Telegram.WebApp;
    tg.ready();
    tg.expand();
    tg.setHeaderColor("#0d1117");
    modalHeader.style.display = 'none';
    tg.BackButton.hide();
  }

  async function loadYamlWebsites() {
    try {
      const response = await fetch("https://9112000.github.io/RealPega/application.yaml"");
      const yamlText = await response.text();
      const data = jsyaml.load(yamlText);
      if (data && data.websites) {
        data.websites.forEach(site => {
          const btn = document.createElement("button");
          btn.className = "option-btn";
          btn.textContent = site.name;
          btn.onclick = () => openModal(site.name, site.url);
          buttonsContainer.appendChild(btn);
        });
      }
    } catch (err) {
      console.error("YAML load error:", err);
    }
  }

  await loadYamlWebsites();
});
  </script>
</body>
</html>
